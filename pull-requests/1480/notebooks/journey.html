
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/logo.png" sizes="482x536" rel="icon" type="image/png">
    <title>How to work with Journeys &#8212; JuPedSim  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d742c9ce" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/journey';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://www.jupedsim.org/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.3.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lane formation in bi-directional flow" href="lane-formation.html" />
    <link rel="prev" title="Movement through Bottlenecks" href="double-bottleneck.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/jupedsim.svg" class="logo__image only-light" alt="JuPedSim  documentation - Home"/>
    <script>document.write(`<img src="../_static/jupedsim.svg" class="logo__image only-dark" alt="JuPedSim  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PedestrianDynamics/jupedsim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/jupedsim/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/jupedsim" class="icon-link-image" alt="PyPI"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://doi.org/10.5281/zenodo.1293771" title="DOI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.1293771.svg" class="icon-link-image" alt="DOI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/routing.html">Routing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../pedestrian_models/index.html">Pedestrian Models</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Notebooks</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model-comparison.html">Comparative Analysis of Pedestrian Dynamics Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="corner.html">Movement around Corners</a></li>

<li class="toctree-l2"><a class="reference internal" href="double-bottleneck.html">Movement through Bottlenecks</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">How to work with Journeys</a></li>

<li class="toctree-l2"><a class="reference internal" href="lane-formation.html">Lane formation in bi-directional flow</a></li>

<li class="toctree-l2"><a class="reference internal" href="motivation.html">Modelling Motivation</a></li>

<li class="toctree-l2"><a class="reference internal" href="queues_waiting.html">Waiting in Queues</a></li>

<li class="toctree-l2"><a class="reference internal" href="routing.html">How Route Choice can Impact Evacuation Times</a></li>

<li class="toctree-l2"><a class="reference internal" href="single-file.html">Simulating Single-File Movement</a></li>

</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jupedsim/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation/citation.html">Cite JuPedSim</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="header-article-item"><button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to work with Journeys</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to work with Journeys</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-simulation-geometry-and-routing-instructions">Preparing the Simulation: Geometry and Routing Instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-transition-strategies">Exploring Transition Strategies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-path-strategy">Direct Path Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#balanced-load-strategy">Balanced Load Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-robin-strategy">Round Robin Strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-simulation">Executing the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-trajectories">Visualizing the Trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-results">Analysis of the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-profiles">Calculate profiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-evacuation-duration">Analyzing Evacuation Duration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#findings-and-conclusions">Findings and Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#future-considerations">Future Considerations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-work-with-journeys">
<h1>How to work with Journeys<a class="headerlink" href="#how-to-work-with-journeys" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/2190f2e7dd8f5635d5d5a042c5ead31b/journey.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
<p>With JuPedSim, directing agents towards exits and ensuring a smooth evacuation from the simulation area is straightforward and versatile.
There might be scenarios where it’s vital to navigate agents along various paths, thus creating diverse evacuation situations.
Let’s explore different routing strategies of agents using a simple geometric space - a corner.</p>
<p>JuPedSim manages routing by geometrically triangulating the simulation area. Without user-defined routing strategies, agents, for example, in a corner simulation, naturally move towards the inner edge of the corner. Look at this visualization where the given direction of each agent is shown by a red line. You’ll observe all red lines lead towards the exit along the inner edge of the corner. While it seems logical, this path isn’t always optimal and could result in a bottleneck, thereby slowing down the evacuation process.</p>
<p><img alt="" src="../_images/shortest_path.gif" /></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jupedsim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pedpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</details>
</div>
<section id="preparing-the-simulation-geometry-and-routing-instructions">
<h2>Preparing the Simulation: Geometry and Routing Instructions<a class="headerlink" href="#preparing-the-simulation-geometry-and-routing-instructions" title="Link to this heading">#</a></h2>
<p>Let’s start by setting up a basic polygon. This will serve as our main simulation area where agents will be distributed.
Additionally, we’ll mark an exit area using another polygon. When agents enter this exit area, they’re deemed to have safely evacuated and will be removed from the ongoing simulation.</p>
<p>Next, we’ll introduce an initial target for the agents: a sizable circular area (known as a switch). After the simulation kickstarts, agents will first head towards this circle. Once they enter the circle, they’ll be directed to one of three distinct waypoints, set diagonally along the curve of the corner.</p>
<p>For the simulation’s onset, all agents will be positioned inside a rectangular zone at the corner’s base.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
    <span class="p">[(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">exit_polygon</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">6.8</span><span class="p">,</span> <span class="mf">14.8</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">14.8</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">6.8</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">)]</span>
<span class="n">switch_point</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">)</span>
<span class="n">waypoints</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">distance_to_waypoints</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">distance_to_switch</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">distribution_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
    <span class="p">[[</span><span class="mf">22.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">10.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">22.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.8</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">walkable_area</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span><span class="n">simulation_polygon</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">distribution_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">centroid</span> <span class="o">=</span> <span class="n">distribution_polygon</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">centroid</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">switch_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">switch_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span>
    <span class="p">(</span><span class="n">switch_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">switch_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">distance_to_switch</span><span class="p">,</span>
    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="s2">&quot;Switch&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="n">switch_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">switch_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waypoints</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">waypoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">waypoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;WP </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">waypoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">waypoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">),</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span>
        <span class="p">(</span><span class="n">waypoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">waypoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">distance_to_waypoints</span><span class="p">,</span>
        <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/add10b04f06213e1c53b9ee932f8c10d09097c6b904c11e26a6ce60980db79c7.png" src="../_images/add10b04f06213e1c53b9ee932f8c10d09097c6b904c11e26a6ce60980db79c7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_agents</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">distribute_by_number</span><span class="p">(</span>
    <span class="n">polygon</span><span class="o">=</span><span class="n">distribution_polygon</span><span class="p">,</span>
    <span class="n">number_of_agents</span><span class="o">=</span><span class="n">num_agents</span><span class="p">,</span>
    <span class="n">distance_to_agents</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">distance_to_polygon</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exploring-transition-strategies">
<h2>Exploring Transition Strategies<a class="headerlink" href="#exploring-transition-strategies" title="Link to this heading">#</a></h2>
<p>All agents initially set their course towards the switch_point. After reaching it, they navigate towards intermediate goals (waypoints) before making their way to the final exit. The challenge lies in deciding which waypoint each agent should target next.</p>
<p>Let’s explore three unique methods to determine these transition strategies:</p>
<ol class="arabic simple">
<li><p><strong>Direct Path Strategy</strong>: Here, every agent simply aims for the first waypoint, mirroring a shortest path algorithm.</p></li>
<li><p><strong>Balanced Load Strategy</strong>: Agents are directed towards the least occupied waypoint, ensuring a more balanced distribution.</p></li>
<li><p><strong>Round Robin Strategy</strong>: Waypoints are sequentially assigned to agents, rotating through each in turn.</p></li>
</ol>
<hr class="docutils" />
<section id="direct-path-strategy">
<h3>Direct Path Strategy<a class="headerlink" href="#direct-path-strategy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shortest_path</span><span class="p">(</span><span class="n">simulation</span><span class="p">:</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">switch_id</span><span class="p">,</span> <span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a journey with fixed transitions for a given simulation.&quot;&quot;&quot;</span>

    <span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">switch_id</span><span class="p">,</span> <span class="o">*</span><span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">])</span>
    <span class="c1"># switch ---&gt; 1st waypoint</span>
    <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">switch_id</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="c1"># 1st waypoint ---&gt; exit</span>
    <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">exit_id</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">journey_id</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="balanced-load-strategy">
<h3>Balanced Load Strategy<a class="headerlink" href="#balanced-load-strategy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">least_targeted</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">:</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">switch_id</span><span class="p">,</span> <span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a journey with least targeted transitions for a given simulation.&quot;&quot;&quot;</span>

    <span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">switch_id</span><span class="p">,</span> <span class="o">*</span><span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">])</span>
    <span class="c1"># switch ---&gt; least targeted waypoint</span>
    <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">switch_id</span><span class="p">,</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_least_targeted_transition</span><span class="p">(</span><span class="n">waypoint_ids</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># from all waypoints ---&gt; exit</span>
    <span class="k">for</span> <span class="n">waypoint_id</span> <span class="ow">in</span> <span class="n">waypoint_ids</span><span class="p">:</span>
        <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
            <span class="n">waypoint_id</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">exit_id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">journey_id</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="round-robin-strategy">
<h3>Round Robin Strategy<a class="headerlink" href="#round-robin-strategy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">round_robin</span><span class="p">(</span><span class="n">simulation</span><span class="p">:</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">switch_id</span><span class="p">,</span> <span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a journey with least round-robin transitions for a given simulation.&quot;&quot;&quot;</span>

    <span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">switch_id</span><span class="p">,</span> <span class="o">*</span><span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">])</span>
    <span class="c1"># switch ---&gt; 1st waypoint with weight1</span>
    <span class="c1"># switch ---&gt; 2nd waypoint with weight2</span>
    <span class="c1"># switch ---&gt; 3th waypoint with weight3</span>
    <span class="n">weight1</span><span class="p">,</span> <span class="n">weight2</span><span class="p">,</span> <span class="n">weight3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">switch_id</span><span class="p">,</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_round_robin_transition</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">weight1</span><span class="p">),</span>
                <span class="p">(</span><span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weight2</span><span class="p">),</span>
                <span class="p">(</span><span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">weight3</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># from all waypoints ---&gt; exit</span>
    <span class="k">for</span> <span class="n">waypoint_id</span> <span class="ow">in</span> <span class="n">waypoint_ids</span><span class="p">:</span>
        <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
            <span class="n">waypoint_id</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">exit_id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">journey_id</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scenarios</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">shortest_path</span><span class="p">,</span>
    <span class="n">least_targeted</span><span class="p">,</span>
    <span class="n">round_robin</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="executing-the-simulation">
<h2>Executing the Simulation<a class="headerlink" href="#executing-the-simulation" title="Link to this heading">#</a></h2>
<p>With all components in place, we’re set to initiate the simulation.
For this demonstration, the trajectories will be recorded in an sqlite database.</p>
<p>First we setup some agent parameters then run three simulation with the different strategies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_scenario_simulation</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">agent_parameters</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs a simulation for a given scenario using the provided simulation object, agent parameters, and positions.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.sqlite&quot;</span>

    <span class="n">simulation</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
        <span class="n">dt</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(</span>
            <span class="n">strength_neighbor_repulsion</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span>
            <span class="n">range_neighbor_repulsion</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">range_geometry_repulsion</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
        <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span>
    <span class="n">switch_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">(</span><span class="n">switch_point</span><span class="p">,</span> <span class="n">distance_to_switch</span><span class="p">)</span>
    <span class="n">waypoint_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">(</span><span class="n">waypoint</span><span class="p">,</span> <span class="n">distance_to_waypoints</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="n">waypoints</span>
    <span class="p">]</span>
    <span class="n">agent_parameters</span><span class="o">.</span><span class="n">stage_id</span> <span class="o">=</span> <span class="n">switch_id</span>
    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">scenario</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">switch_id</span><span class="p">,</span> <span class="n">waypoint_ids</span><span class="p">,</span> <span class="n">exit_id</span><span class="p">)</span>
    <span class="n">agent_parameters</span><span class="o">.</span><span class="n">journey_id</span> <span class="o">=</span> <span class="n">journey_id</span>
    <span class="k">for</span> <span class="n">new_pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">agent_parameters</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">new_pos</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent_parameters</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">simulation</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="n">simulation</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="p">:</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">iteration_count</span> <span class="o">=</span> <span class="n">run_scenario_simulation</span><span class="p">(</span>
        <span class="n">scenario</span><span class="p">,</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(),</span>
        <span class="n">positions</span><span class="p">,</span>
        <span class="n">walkable_area</span><span class="o">.</span><span class="n">polygon</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-trajectories">
<h2>Visualizing the Trajectories<a class="headerlink" href="#visualizing-the-trajectories" title="Link to this heading">#</a></h2>
<p>To visualize trajectories, we’ll pull simulation data from the SQLite database and then employ a helper function to depict the agent movements. For subsequent analyses, we’ll organize these trajectory files within a dictionary for easy access.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">agent_trajectories</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="p">:</span>
    <span class="n">scenario_name</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">agent_trajectories</span><span class="p">[</span><span class="n">scenario_name</span><span class="p">],</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">.sqlite&quot;</span>
    <span class="p">)</span>
    <span class="n">animate</span><span class="p">(</span>
        <span class="n">agent_trajectories</span><span class="p">[</span><span class="n">scenario_name</span><span class="p">],</span>
        <span class="n">walkable_area</span><span class="p">,</span>
        <span class="n">title_note</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Scenario: </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">every_nth_frame</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#analysis-of-the-results" title="Link to this heading">#</a></h2>
<p>With three distinct evacuation simulations completed, it’s time to dive into the outcomes. Let’s start by visualizing the trajectories. This will give us an initial insight into the variations among the scenarios:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agent_trajectories</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_trajectories</span><span class="p">(</span>
        <span class="n">traj</span><span class="o">=</span><span class="n">agent_trajectories</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
        <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">traj_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">traj_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;Exit&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2c53a864e2e562f8e0111d72ed3f0526ddd149eb2114ff7e9ebc7f09f8858022.png" src="../_images/2c53a864e2e562f8e0111d72ed3f0526ddd149eb2114ff7e9ebc7f09f8858022.png" />
</div>
</div>
</section>
<section id="calculate-profiles">
<h2>Calculate profiles<a class="headerlink" href="#calculate-profiles" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>


<span class="k">def</span><span class="w"> </span><span class="nf">calculate_density_average_classic</span><span class="p">(</span>
    <span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">nframes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">Y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate classical method</span>

<span class="sd">    Density = mean_time(N/A_i)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">geominX</span><span class="p">,</span> <span class="n">geominY</span><span class="p">,</span> <span class="n">geomaxX</span><span class="p">,</span> <span class="n">geomaxY</span> <span class="o">=</span> <span class="n">bounds</span>
    <span class="n">xbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">geominX</span><span class="p">,</span> <span class="n">geomaxX</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">geominY</span><span class="p">,</span> <span class="n">geomaxY</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic_2d</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span>
        <span class="n">Y</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;count&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">xbins</span><span class="p">,</span> <span class="n">ybins</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">statistic</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">/</span> <span class="n">nframes</span> <span class="o">/</span> <span class="n">area</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">plotly.subplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_subplots</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_classical_density_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">rho_max</span><span class="p">):</span>
    <span class="n">geominX</span><span class="p">,</span> <span class="n">geominY</span><span class="p">,</span> <span class="n">geomaxX</span><span class="p">,</span> <span class="n">geomaxY</span> <span class="o">=</span> <span class="n">walkable_area</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">([</span><span class="n">title</span><span class="p">]))</span>
    <span class="n">xbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">geominX</span><span class="p">,</span> <span class="n">geomaxX</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">geominY</span><span class="p">,</span> <span class="n">geomaxY</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">walkable_area</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">xbins</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">ybins</span><span class="p">,</span>
        <span class="n">z</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">zmax</span><span class="o">=</span><span class="n">rho_max</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">connectgaps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">zsmooth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Density: %</span><span class="si">{z:.2f}</span><span class="s2">&lt;br&gt;</span><span class="se">\n</span><span class="s2">Pos: (%</span><span class="si">{x:2f}</span><span class="s2">: %</span><span class="si">{y:.2f}</span><span class="s2">}&quot;</span><span class="p">,</span>
        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">),</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>
    <span class="c1">#    Geometry walls</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wall&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>

<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">rho_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
    <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">agent_trajectories</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">agent_trajectories</span><span class="p">):</span>
    <span class="n">trajectories</span> <span class="o">=</span> <span class="n">agent_trajectories</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">calculate_density_average_classic</span><span class="p">(</span>
        <span class="n">walkable_area</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">,</span>
        <span class="n">nframes</span><span class="o">=</span><span class="n">trajectories</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="n">X</span><span class="o">=</span><span class="n">trajectories</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="n">Y</span><span class="o">=</span><span class="n">trajectories</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">rho_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">rho_max</span><span class="p">)</span>
    <span class="n">ind_fig</span> <span class="o">=</span> <span class="n">plot_classical_density_profile</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">rho_max</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">ind_fig</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X [m]&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y [m]&quot;</span><span class="p">,</span> <span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="analyzing-evacuation-duration">
<h2>Analyzing Evacuation Duration<a class="headerlink" href="#analyzing-evacuation-duration" title="Link to this heading">#</a></h2>
<p>To further understand our earlier observations, we compute the <span class="math notranslate nohighlight">\(N−t\)</span> diagram, which shows when an agent crosses a designated measurement line.
We position this line near the exit and evaluate the <span class="math notranslate nohighlight">\(N−t\)</span> curves for all three simulations, subsequently determining the respective evacuation durations.</p>
<p>Note: It’s essential to position the measurement line inside the simulation area, ensuring that agents <strong>cross</strong> it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">measurement_line</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">MeasurementLine</span><span class="p">([[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">agent_trajectories</span><span class="p">):</span>
    <span class="n">nt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_n_t</span><span class="p">(</span>
        <span class="n">traj_data</span><span class="o">=</span><span class="n">agent_trajectories</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
        <span class="n">measurement_line</span><span class="o">=</span><span class="n">measurement_line</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_nt</span><span class="p">(</span><span class="n">nt</span><span class="o">=</span><span class="n">nt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">Time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">nt</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Name: </span><span class="si">{:&lt;20}</span><span class="s2"> Evacuation time: </span><span class="si">{:&lt;15}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Time</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Name: shortest_path        Evacuation time: 88.4 seconds   
Name: least_targeted       Evacuation time: 65.0 seconds   
Name: round_robin          Evacuation time: 64.2 seconds   
</pre></div>
</div>
<img alt="../_images/db6eb777b52320b490fa4891d6930a16a1da12e01becba0b0cef666bbb7a3d9f.png" src="../_images/db6eb777b52320b490fa4891d6930a16a1da12e01becba0b0cef666bbb7a3d9f.png" />
</div>
</div>
</section>
<section id="findings-and-conclusions">
<h2>Findings and Conclusions<a class="headerlink" href="#findings-and-conclusions" title="Link to this heading">#</a></h2>
<p>The exploration of density profiles demonstrates notable variations in agent distribution, contingent upon the algorithm employed. The shortest path algorithm, aligning with our initial predictions, induces higher densities prior to encountering the corner. Conversely, the round-robin algorithm demonstrates a capacity to redistribute the jam, steering agents away from the corner bend and facilitating a more even spread around it.</p>
<p>A vital observation from the simulations underscores the role of waypoint placement, particularly when positioned as circles, along with the discernment of their range. This cruciality not only impacts agent navigation but also influences the effectiveness of the deployed algorithm.</p>
</section>
<section id="future-considerations">
<h2>Future Considerations<a class="headerlink" href="#future-considerations" title="Link to this heading">#</a></h2>
<p>As the waypoint placement proves to be instrumental, ensuing studies or simulations might delve into optimizing these placements, exploring a range of scenarios and algorithmic strategies to discern optimal configurations for various contexts. Furthermore, additional research could investigate the scalability of these findings, examining the consistency of agent distribution patterns in scenarios with varying agent quantities, environmental layouts, and navigational complexities.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download">
<h1>Download<a class="headerlink" href="#download" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/2190f2e7dd8f5635d5d5a042c5ead31b/journey.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="double-bottleneck.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Movement through Bottlenecks</p>
      </div>
    </a>
    <a class="right-next"
       href="lane-formation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lane formation in bi-directional flow</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to work with Journeys</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-simulation-geometry-and-routing-instructions">Preparing the Simulation: Geometry and Routing Instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-transition-strategies">Exploring Transition Strategies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-path-strategy">Direct Path Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#balanced-load-strategy">Balanced Load Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#round-robin-strategy">Round Robin Strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-simulation">Executing the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-trajectories">Visualizing the Trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-results">Analysis of the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-profiles">Calculate profiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-evacuation-duration">Analyzing Evacuation Duration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#findings-and-conclusions">Findings and Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#future-considerations">Future Considerations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Forschungszentrum Jülich GmbH, IAS-7.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>