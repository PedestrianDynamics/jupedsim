
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/logo.png" sizes="482x536" rel="icon" type="image/png">
    <title>Simulating Single-File Movement &#8212; JuPedSim  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d742c9ce" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/single-file';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://www.jupedsim.org/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.3.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="JuPedSim" href="../history.html" />
    <link rel="prev" title="How Route Choice can Impact Evacuation Times" href="routing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/jupedsim.svg" class="logo__image only-light" alt="JuPedSim  documentation - Home"/>
    <script>document.write(`<img src="../_static/jupedsim.svg" class="logo__image only-dark" alt="JuPedSim  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PedestrianDynamics/jupedsim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/jupedsim/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/jupedsim" class="icon-link-image" alt="PyPI"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://doi.org/10.5281/zenodo.1293771" title="DOI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.1293771.svg" class="icon-link-image" alt="DOI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/routing.html">Routing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../pedestrian_models/index.html">Pedestrian Models</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Notebooks</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model-comparison.html">Comparative Analysis of Pedestrian Dynamics Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="corner.html">Movement around Corners</a></li>

<li class="toctree-l2"><a class="reference internal" href="double-bottleneck.html">Movement through Bottlenecks</a></li>

<li class="toctree-l2"><a class="reference internal" href="journey.html">How to work with Journeys</a></li>

<li class="toctree-l2"><a class="reference internal" href="lane-formation.html">Lane formation in bi-directional flow</a></li>

<li class="toctree-l2"><a class="reference internal" href="motivation.html">Modelling Motivation</a></li>

<li class="toctree-l2"><a class="reference internal" href="queues_waiting.html">Waiting in Queues</a></li>

<li class="toctree-l2"><a class="reference internal" href="routing.html">How Route Choice can Impact Evacuation Times</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Simulating Single-File Movement</a></li>

</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jupedsim/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation/citation.html">Cite JuPedSim</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="header-article-item"><button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Simulating Single-File Movement</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Simulating Single-File Movement</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-overview">Scenario Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-journey">Defining the Journey</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-simulation">Executing the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>

<span class="c1"># from matplotlib.patches import Circle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jupedsim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pedpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="simulating-single-file-movement">
<h1>Simulating Single-File Movement<a class="headerlink" href="#simulating-single-file-movement" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/524528f6888c3f566f3b15c154a09c4d/single-file.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
<p>Pedestrian dynamics often focuses on the relationship between two key variables: density and either flow or velocity. The relationship is often visualized in what’s termed as the fundamental diagram. By quantifying the capacity of pedestrian facilities, it serves as an essential tool for evaluating escape routes in emergencies and determining the effectiveness of various pedestrian movement models when depicting pedestrian streams.</p>
<p>A fundamental question arises: how does one investigate the intricacies of the fundamental diagram without the interference of external factors?</p>
<p>Single-file movement presents the simplest possible system in pedestrian dynamics. It is envisioned as the unidirectional motion of individuals moving along a straight line, thereby considerably reducing the degrees of freedom. In essence, by stripping down the system to this basic representation, it limits the external factors that might affect the outcomes. As a result, any observations or patterns detected can be attributed with higher confidence to the direct interplay between density and flow, providing a clearer understanding of the fundamental diagram.</p>
<p>In this tutorial, we’ll simulate with JuPedSim a simplified geometry with closed boundary conditions acording to <a class="reference external" href="https://doi.org/10.3390/app13095450">Paetzke</a>.</p>
<p><img alt="" src="../../notebooks/demo-data/single-file/single-file.png" /></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_oval_shape_points</span><span class="p">(</span>
    <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.3</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.65</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate points on a closed setup with two segments and two half circles.&quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="n">selected_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="n">last_selected</span> <span class="o">=</span> <span class="n">start</span>  <span class="c1"># keep track of the last selected point</span>

    <span class="c1"># Define the points&#39; generating functions</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dist</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

    <span class="c1"># Calculate dphi based on the dx and radius</span>
    <span class="n">dphi</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">radius</span>

    <span class="n">center2</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span><span class="p">)</span>
    <span class="n">center1</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span><span class="p">)</span>

    <span class="n">npoint_on_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>

    <span class="c1"># first segment</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">npoint_on_segment</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">tmp_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">,</span> <span class="n">last_selected</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">selected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
            <span class="n">last_selected</span> <span class="o">=</span> <span class="n">tmp_point</span>

    <span class="c1"># first half circle</span>
    <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dphi</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">center2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">center2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">tmp_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">,</span> <span class="n">last_selected</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">selected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
            <span class="n">last_selected</span> <span class="o">=</span> <span class="n">tmp_point</span>

    <span class="c1"># second segment</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">npoint_on_segment</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">tmp_point</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">npoint_on_segment</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span>
            <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">,</span> <span class="n">last_selected</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">selected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
            <span class="n">last_selected</span> <span class="o">=</span> <span class="n">tmp_point</span>

    <span class="c1"># second half circle</span>
    <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">dphi</span><span class="p">,</span> <span class="n">dphi</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">center1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">center1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">tmp_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">,</span> <span class="n">last_selected</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">selected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_point</span><span class="p">)</span>
            <span class="n">last_selected</span> <span class="o">=</span> <span class="n">tmp_point</span>

    <span class="k">if</span> <span class="n">dist</span><span class="p">(</span><span class="n">selected_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">selected_points</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">num_points</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_points</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;warning: </span><span class="si">{</span><span class="n">num_points</span><span class="si">}</span><span class="s2"> &gt; Allowed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">selected_points</span> <span class="o">=</span> <span class="n">selected_points</span><span class="p">[:</span><span class="n">num_points</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">selected_points</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">exterior</span> <span class="o">=</span> <span class="n">generate_oval_shape_points</span><span class="p">(</span>
    <span class="mi">48</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.65</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span>
<span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">interior</span> <span class="o">=</span> <span class="n">generate_oval_shape_points</span><span class="p">(</span>
    <span class="mi">35</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.65</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span>
<span class="p">)</span>
<span class="n">walkable_area</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span>
    <span class="n">shapely</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">exterior</span><span class="p">),</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">interior</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-inpput docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">find_nearest_clockwise_waypoint</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">all_points</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">all_points</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">all_points</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">waypoints</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_points</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="scenario-overview">
<h2>Scenario Overview<a class="headerlink" href="#scenario-overview" title="Link to this heading">#</a></h2>
<p>Let’s begin by positioning <span class="math notranslate nohighlight">\(N\)</span> agents along the central path within our specified geometry. This particular geometry presents an interesting challenge; though our goal is to simulate a movement akin to 1D, where agents traverse a straight line, the line here is bent.</p>
<p>We will set up the waypoints and agent positions based on the circuit illustrated by the dashed line in the preceding figure.</p>
<p>Each agent will be assigned its initial waypoint to aim for.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">distribute_agents_and_waypoints</span><span class="p">(</span><span class="n">total_agents</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">all_waypoints</span><span class="p">,</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">generate_oval_shape_points</span><span class="p">(</span>
        <span class="n">num_points</span><span class="o">=</span><span class="n">total_agents</span>
    <span class="p">)</span>
    <span class="n">first_waypoints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">first_waypoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">find_nearest_clockwise_waypoint</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span> <span class="n">all_waypoints</span><span class="p">,</span> <span class="n">all_waypoints</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">all_waypoints</span><span class="p">,</span> <span class="n">first_waypoints</span><span class="p">,</span> <span class="n">positions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_points_and_polygons</span><span class="p">(</span>
    <span class="n">all_waypoints</span><span class="p">,</span> <span class="n">choosen_waypoints</span><span class="p">,</span> <span class="n">exterior</span><span class="p">,</span> <span class="n">interior</span><span class="p">,</span> <span class="n">positions</span>
<span class="p">):</span>
    <span class="vm">__file__</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">x_exterior</span><span class="p">,</span> <span class="n">y_exterior</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exterior</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_exterior</span><span class="p">,</span> <span class="n">y_exterior</span><span class="p">,</span> <span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exterior&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x_exterior</span><span class="p">,</span> <span class="n">y_exterior</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">x_interior</span><span class="p">,</span> <span class="n">y_interior</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">interior</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interior</span><span class="p">,</span> <span class="n">y_interior</span><span class="p">,</span> <span class="s2">&quot;--k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;interior&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x_interior</span><span class="p">,</span> <span class="n">y_interior</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">x_awp</span><span class="p">,</span> <span class="n">y_awp</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">all_waypoints</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_awp</span><span class="p">,</span> <span class="n">y_awp</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x_awp</span><span class="p">,</span> <span class="n">y_awp</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">all_waypoints</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;waypoints&quot;</span><span class="p">)</span>

    <span class="n">x_agents</span><span class="p">,</span> <span class="n">y_agents</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_agents</span><span class="p">,</span> <span class="n">y_agents</span><span class="p">,</span> <span class="s2">&quot;ob&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;agents&quot;</span><span class="p">)</span>

    <span class="n">x_wp</span><span class="p">,</span> <span class="n">y_wp</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">choosen_waypoints</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_wp</span><span class="p">,</span> <span class="n">y_wp</span><span class="p">,</span> <span class="s2">&quot;xk&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;first goals&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_unit_vector</span><span class="p">(</span><span class="n">new_pos</span><span class="p">,</span> <span class="n">wp</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">wp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">magnitude</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">magnitude</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">ux</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">magnitude</span>
    <span class="n">uy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">magnitude</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="defining-the-journey">
<h2>Defining the Journey<a class="headerlink" href="#defining-the-journey" title="Link to this heading">#</a></h2>
<p>For our simulation, we’re aiming for movement within a closed system. To achieve this, we’ll establish a cyclical transition between waypoints, allowing agents to seamlessly move from one waypoint to the next. Given this structure, agents are confined within the system, eliminating the need for exit points.</p>
<p>While the starting orientation of our agents might not play a pivotal role, we’ll still configure it for precision. This means that, from the outset, each agent will be oriented towards its initially selected waypoint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_waypoints</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span> <span class="n">all_waypoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">id</span><span class="p">]:</span>
    <span class="n">waypoint_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">waypoints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">for</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="n">all_waypoints</span><span class="p">:</span>
        <span class="n">wp_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">(</span><span class="n">waypoint</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">waypoint_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wp_id</span><span class="p">)</span>
        <span class="n">waypoints</span><span class="p">[</span><span class="n">waypoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">wp_id</span>

    <span class="k">return</span> <span class="n">waypoints</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_journey</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">:</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">id</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">waypoint_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">waypoints</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">(</span><span class="n">waypoint_ids</span><span class="p">)</span>
    <span class="c1"># create a circular transition from wp to next wp</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waypoint_ids</span><span class="p">):</span>
        <span class="n">next_waypoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">waypoint_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">waypoint_ids</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="n">waypoint_ids</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
            <span class="n">waypoint</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">next_waypoint</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">journey_id</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_model_to_simulation</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">:</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span>
    <span class="n">positions</span><span class="p">,</span>
    <span class="n">choosen_waypoints</span><span class="p">,</span>
    <span class="n">waypoints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">id</span><span class="p">],</span>
    <span class="n">journey_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">agent_parameters</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">()</span>
    <span class="n">agent_parameters</span><span class="o">.</span><span class="n">journey_id</span> <span class="o">=</span> <span class="n">journey_id</span>
    <span class="k">for</span> <span class="n">wp</span><span class="p">,</span> <span class="n">new_pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">choosen_waypoints</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
        <span class="n">agent_parameters</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">new_pos</span>
        <span class="n">agent_parameters</span><span class="o">.</span><span class="n">stage_id</span> <span class="o">=</span> <span class="n">waypoints</span><span class="p">[</span><span class="n">wp</span><span class="p">]</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="executing-the-simulation">
<h2>Executing the Simulation<a class="headerlink" href="#executing-the-simulation" title="Link to this heading">#</a></h2>
<p>Now, we’ll proceed to run our simulation up to a predefined maximum iteration count. This approach lets the internal dynamics stabilize, potentially reaching a steady state. However, it’s worth noting that certain dynamics, like stop-and-go waves, might prevent the system from settling into such a state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_simulation</span><span class="p">(</span><span class="n">total_agents</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">number_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">):</span>
    <span class="p">(</span>
        <span class="n">all_waypoints</span><span class="p">,</span>
        <span class="n">first_waypoints</span><span class="p">,</span>
        <span class="n">positions</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">distribute_agents_and_waypoints</span><span class="p">(</span><span class="n">total_agents</span><span class="p">)</span>
    <span class="n">plot_points_and_polygons</span><span class="p">(</span>
        <span class="n">all_waypoints</span><span class="p">,</span> <span class="n">first_waypoints</span><span class="p">,</span> <span class="n">exterior</span><span class="p">,</span> <span class="n">interior</span><span class="p">,</span> <span class="n">positions</span>
    <span class="p">)</span>
    <span class="n">trajectory_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;single-file-</span><span class="si">{</span><span class="n">total_agents</span><span class="si">}</span><span class="s2">.sqlite&quot;</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
        <span class="n">dt</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(</span>
            <span class="n">strength_neighbor_repulsion</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span>
            <span class="n">range_neighbor_repulsion</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">range_geometry_repulsion</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">geometry</span><span class="o">=</span><span class="n">exterior</span><span class="p">,</span>
        <span class="n">excluded_areas</span><span class="o">=</span><span class="n">interior</span><span class="p">,</span>
        <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">waypoints</span> <span class="o">=</span> <span class="n">init_waypoints</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">all_waypoints</span><span class="p">)</span>
    <span class="n">journey_id</span> <span class="o">=</span> <span class="n">init_journey</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">)</span>
    <span class="n">add_model_to_simulation</span><span class="p">(</span>
        <span class="n">simulation</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">first_waypoints</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">,</span> <span class="n">journey_id</span>
    <span class="p">)</span>

    <span class="k">while</span> <span class="n">simulation</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">number_iterations</span><span class="p">:</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">trajectory_file</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e7a4028c1971c5439bd769918593953d1525cc6de9a35fc743b933143309809e.png" src="../_images/e7a4028c1971c5439bd769918593953d1525cc6de9a35fc743b933143309809e.png" />
<img alt="../_images/2e457f0d971848608298bfdcfc756eb7c94d79e243d13b7613fde9c132e8f665.png" src="../_images/2e457f0d971848608298bfdcfc756eb7c94d79e243d13b7613fde9c132e8f665.png" />
<img alt="../_images/3ff3d1431a7af5ae99fc1200b1a43e365390971e08d5f3868ab7b13332de2ead.png" src="../_images/3ff3d1431a7af5ae99fc1200b1a43e365390971e08d5f3868ab7b13332de2ead.png" />
<img alt="../_images/3f4d7078e18d610140ff193443b27ed7cbdd923e2d777672346960d60f0b2ab9.png" src="../_images/3f4d7078e18d610140ff193443b27ed7cbdd923e2d777672346960d60f0b2ab9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="k">for</span> <span class="n">trajectory_file</span> <span class="ow">in</span> <span class="n">trajectory_files</span><span class="p">:</span>
    <span class="n">trajectories</span><span class="p">,</span> <span class="n">walkable_area_sqlite</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">)</span>
    <span class="n">animate</span><span class="p">(</span><span class="n">trajectories</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">,</span> <span class="n">every_nth_frame</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h2>
<p>The behavior of agents closely following a central path can be attributed to the dense distribution of waypoints with a small radius. Essentially, the dense waypoints give agents minimal options for deviation, making them adhere closely to the specified path. This can be advantageous in scenarios where precise path-following is necessary.</p>
<p>However, the observed behavior of stop-and-go waves disappearing over time indicates an imperfection in the model, especially if such dynamics are expected or seen in real-world scenarios that the model aims to emulate. The fading of these waves suggests that the agents stabilize into a flow that doesn’t have the intermittent stop-and-go behavior.</p>
<p>Velocity-based models often have this limitation. In such models, agents typically adjust their velocities based on surrounding conditions. Once the initial disturbances (like starting from rest or initial congestions) are overcome, the agents find a sort of “equilibrium” velocity, leading to a smoother flow. This smooth flow may not always accurately represent real-world dynamics, especially in situations with frequent perturbations or inherent unpredictabilities, like human-driven traffic.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>The model effectively simulates agents that adhere closely to a central path due to the dense distribution of waypoints with small radii. However, the disappearance of stop-and-go waves over time highlights a limitation inherent to velocity-based models. Such models may not be suitable for scenarios where persistent stop-and-go dynamics are expected or required. Future iterations of the model may benefit from incorporating additional factors or behaviors to better simulate such dynamics.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download">
<h1>Download<a class="headerlink" href="#download" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/524528f6888c3f566f3b15c154a09c4d/single-file.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="routing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How Route Choice can Impact Evacuation Times</p>
      </div>
    </a>
    <a class="right-next"
       href="../history.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JuPedSim</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Simulating Single-File Movement</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-overview">Scenario Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-journey">Defining the Journey</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-simulation">Executing the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Forschungszentrum Jülich GmbH, IAS-7.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>