
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/logo.png" sizes="482x536" rel="icon" type="image/png">
    <title>Waiting in Queues &#8212; JuPedSim  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d742c9ce" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/queues_waiting';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://www.jupedsim.org/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v2.0.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How Route Choice can Impact Evacuation Times" href="routing.html" />
    <link rel="prev" title="Modelling Motivation" href="motivation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/jupedsim.svg" class="logo__image only-light" alt="JuPedSim  documentation - Home"/>
    <script>document.write(`<img src="../_static/jupedsim.svg" class="logo__image only-dark" alt="JuPedSim  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PedestrianDynamics/jupedsim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/jupedsim/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/jupedsim" class="icon-link-image" alt="PyPI"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://doi.org/10.5281/zenodo.1293771" title="DOI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.1293771.svg" class="icon-link-image" alt="DOI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/routing.html">Routing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../pedestrian_models/index.html">Pedestrian Models</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Notebooks</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model-comparison.html">Comparative Analysis of Pedestrian Dynamics Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="corner.html">Movement around Corners</a></li>

<li class="toctree-l2"><a class="reference internal" href="double-bottleneck.html">Movement through Bottlenecks</a></li>

<li class="toctree-l2"><a class="reference internal" href="journey.html">How to work with Journeys</a></li>

<li class="toctree-l2"><a class="reference internal" href="lane-formation.html">Lane formation in bi-directional flow</a></li>

<li class="toctree-l2"><a class="reference internal" href="motivation.html">Modelling Motivation</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Waiting in Queues</a></li>

<li class="toctree-l2"><a class="reference internal" href="routing.html">How Route Choice can Impact Evacuation Times</a></li>

<li class="toctree-l2"><a class="reference internal" href="single-file.html">Simulating Single-File Movement</a></li>

</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jupedsim/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation/citation.html">Cite JuPedSim</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="header-article-item"><button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Waiting in Queues</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Waiting in Queues</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-the-geometry">Definition of the Geometry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-starting-positions-and-exit">Definition of Starting Positions and Exit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-simulation">Setting up the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-queues">Configure the Queues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-journeys">Configure the Journeys</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-simulation">Running the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-results">Visualization of the Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#different-routing-strategy">Different Routing Strategy</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="waiting-in-queues">
<h1>Waiting in Queues<a class="headerlink" href="#waiting-in-queues" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/12533bdc647753bb29c3fe6cba82185e/queues_waiting.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
<p>In the following, we’ll simulate scenarios where agents are waiting in queues as an example for implementing <strong>crowd management measures</strong>. Since waiting behaviour is not a process that can be modelled by the operational model itself we explicitely need to define (and trigger) the <strong>waiting behaviour</strong> of the agents. In this example, we’ll simulate a scenario where people arrive to a concert and can approach the entrance by four line-up gates. At the gates a ticket control is performed that lasts 10 seconds for each person.</p>
<p>Let’s import the required package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jupedsim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pedpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">normal</span>  <span class="c1"># normal distribution of free movement speed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">from_wkt</span><span class="p">,</span> <span class="n">intersection</span>
</pre></div>
</div>
</div>
</div>
<section id="definition-of-the-geometry">
<h2>Definition of the Geometry<a class="headerlink" href="#definition-of-the-geometry" title="Link to this heading">#</a></h2>
<p>The geometry is given in wkt format and can be easily converted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geo_wkt</span> <span class="o">=</span> <span class="s2">&quot;GEOMETRYCOLLECTION (POLYGON ((33.07 62.14, 32.43 60.21, 32.28 58.14, 32.28 56.07, 32.28 53.99, 32.28 51.92, 32.28 49.84, 32.28 47.77, 32.28 44.83, 31.02 44.83, 26.13 44.83, 25.28 44.83, 25.58 49.98, 25.7 52.07, 25.77 54.17, 25.85 56.27, 26.04 58.14, 25.87 60.26, 24.27 61.67, 22.17 61.96, 21.89 62.17, 22.16 67.48, 22.09 68.2, 23.57 68.2, 24.21 68.57, 24.21 71.37, 21.12 71.37, 21.12 76.37, 24.11 76.37, 26.11 76.37, 31.12 76.37, 31.12 71.37, 27.4 71.37, 27.4 68.55, 27.99 68.2, 34.29 68.2, 34.83 68.56, 35.02 65.35, 35.2 62.14, 33.07 62.14), (29.15 57.02, 30.15 58.79, 28.15 58.79, 29.15 57.02), (24.95 68.67, 25.05 68.67, 25.05 71.31, 24.95 71.31, 24.95 68.67), (25.75 68.67, 25.85 68.67, 25.85 71.31, 25.75 71.31, 25.75 68.67), (26.55 68.67, 26.65 68.67, 26.65 71.31, 26.55 71.31, 26.55 68.67)))&quot;</span>
<span class="n">geo</span> <span class="o">=</span> <span class="n">from_wkt</span><span class="p">(</span><span class="n">geo_wkt</span><span class="p">)</span>
<span class="n">walkable_area</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">)</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/32b1a05fca8a8153743785db52ae40382af8ae720d916f4376bcc4607d5a6282.png" src="../_images/32b1a05fca8a8153743785db52ae40382af8ae720d916f4376bcc4607d5a6282.png" />
</div>
</div>
<p>The geometry consists of four entrance gates at the top and an obstacle in the middle. The people should arrive at the bottom. The way to the entrance gates is enclosed by barriers which results in the shown geometry.</p>
</section>
<section id="definition-of-starting-positions-and-exit">
<h2>Definition of Starting Positions and Exit<a class="headerlink" href="#definition-of-starting-positions-and-exit" title="Link to this heading">#</a></h2>
<p>Let’s calculate 20 positions in an area at the bottom of the geometry. The exit area is placed at the very top.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_agents</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">spawning_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">54</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">54</span><span class="p">)])</span>
<span class="n">spawning_area</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">(</span><span class="n">spawning_polygon</span><span class="p">,</span> <span class="n">geo</span><span class="p">)</span>

<span class="n">agent_start_positions</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">distribute_by_number</span><span class="p">(</span>
    <span class="n">polygon</span><span class="o">=</span><span class="n">spawning_area</span><span class="p">,</span>
    <span class="n">number_of_agents</span><span class="o">=</span><span class="n">num_agents</span><span class="p">,</span>
    <span class="n">distance_to_agents</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">distance_to_polygon</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">exit_area</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">76</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">76</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">74</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">74</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at the setup:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_simulation_configuration</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span> <span class="n">spawning_area</span><span class="p">,</span> <span class="n">starting_positions</span><span class="p">,</span> <span class="n">exit_area</span>
<span class="p">):</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">*</span><span class="n">spawning_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">*</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;indianred&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">starting_positions</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x/m&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y/m&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">axes</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_simulation_configuration</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span> <span class="n">spawning_area</span><span class="p">,</span> <span class="n">agent_start_positions</span><span class="p">,</span> <span class="n">exit_area</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;x/m&#39;, ylabel=&#39;y/m&#39;&gt;
</pre></div>
</div>
<img alt="../_images/79e25bef687ade63c04c866533e48f483c58899a5eb2ec70725ce9c410244a1f.png" src="../_images/79e25bef687ade63c04c866533e48f483c58899a5eb2ec70725ce9c410244a1f.png" />
</div>
</div>
</section>
<section id="setting-up-the-simulation">
<h2>Setting up the Simulation<a class="headerlink" href="#setting-up-the-simulation" title="Link to this heading">#</a></h2>
<p>Let’s setup a simulation object using the collision-free speed model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_file</span> <span class="o">=</span> <span class="s2">&quot;queues_waiting.sqlite&quot;</span>  <span class="c1"># output file</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(),</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">geo</span><span class="p">,</span>
    <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-the-queues">
<h2>Configure the Queues<a class="headerlink" href="#configure-the-queues" title="Link to this heading">#</a></h2>
<p>JuPedSim is providing the concept of queues which can be defined as a stage on the agents’ journeys. To let the agents wait at the gates before they walk to the exit, we need to create a queue for each gate by defining several ordered waiting positions.</p>
<p>We define five waiting positions for each gate - three positions in the gate and  two infront:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waiting_positions_gate1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">27.1</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">27.1</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">27.1</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">27.1</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">27.1</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">waiting_positions_gate2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">26.2</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">26.2</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">26.2</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">26.2</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">26.2</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">waiting_positions_gate3</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">25.35</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">25.35</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">25.35</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">25.35</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">25.35</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">waiting_positions_gate4</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">24.5</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">24.5</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">24.5</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">24.5</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">24.5</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
<span class="p">]</span>


<span class="n">waiting_positions_gates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">waiting_positions_gate1</span><span class="p">,</span>
    <span class="n">waiting_positions_gate2</span><span class="p">,</span>
    <span class="n">waiting_positions_gate3</span><span class="p">,</span>
    <span class="n">waiting_positions_gate4</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now we create the queues based on these points and add them to the simulation. The handle for the queues is needed at a later point in the simulation loop to control the waiting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waypoints_gates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_queue_stage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">waiting_positions_gates</span>
<span class="p">]</span>
<span class="n">queue_gates</span> <span class="o">=</span> <span class="p">[</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_stage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">waypoints_gates</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-the-journeys">
<h2>Configure the Journeys<a class="headerlink" href="#configure-the-journeys" title="Link to this heading">#</a></h2>
<p>We want to spread the agents evenly on the queues based on their current load. To do so we define an additional waypoint which implements distributing the agents to the desired (least targeted) entrance gate. In this way, all agents share the same journey but may chose different gates. We place the waypoint for distributing on the left above the obstacle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waypoint_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">27.2</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="n">waypoint_dist</span> <span class="o">=</span> <span class="mf">0.75</span>

<span class="n">waypoint_for_distributing</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">(</span>
    <span class="n">waypoint_coords</span><span class="p">,</span> <span class="n">waypoint_dist</span>
<span class="p">)</span>

<span class="n">exit</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">(</span>
    <span class="n">waypoints_gates</span> <span class="o">+</span> <span class="p">[</span><span class="n">exit</span><span class="p">,</span> <span class="n">waypoint_for_distributing</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to set the transitions on the journey. For the transitions between the waypoint and the gates we choose the <em>least targeted</em> approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
    <span class="n">waypoint_for_distributing</span><span class="p">,</span>
    <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_least_targeted_transition</span><span class="p">(</span><span class="n">waypoints_gates</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="n">waypoints_gates</span><span class="p">:</span>
    <span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">wp</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">exit</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at our setup:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_journey_details</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">source_area</span><span class="p">,</span>
    <span class="n">agent_start_positions</span><span class="p">,</span>
    <span class="n">exit_area</span><span class="p">,</span>
    <span class="n">waiting_positions_queues</span><span class="p">,</span>
    <span class="n">waypoints</span><span class="p">,</span>
    <span class="n">dists</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_simulation_configuration</span><span class="p">(</span>
        <span class="n">walkable_area</span><span class="p">,</span> <span class="n">source_area</span><span class="p">,</span> <span class="n">agent_start_positions</span><span class="p">,</span> <span class="n">exit_area</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">queue_positions</span> <span class="ow">in</span> <span class="n">waiting_positions_queues</span><span class="p">:</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">queue_positions</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coords</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">waypoints</span><span class="p">,</span> <span class="n">dists</span><span class="p">):</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightsteelblue&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_journey_details</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">spawning_area</span><span class="p">,</span>
    <span class="n">agent_start_positions</span><span class="p">,</span>
    <span class="n">exit_area</span><span class="p">,</span>
    <span class="n">waiting_positions_gates</span><span class="p">,</span>
    <span class="p">[</span><span class="n">waypoint_coords</span><span class="p">],</span>
    <span class="p">[</span><span class="n">waypoint_dist</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dd32278550b8b159ecdf02be89d5182d975107df539b2b17b972785f9d7e07b7.png" src="../_images/dd32278550b8b159ecdf02be89d5182d975107df539b2b17b972785f9d7e07b7.png" />
</div>
</div>
<p>The plot shows the several waiting positions per gate and the waypoint for distributing. The agents start from the grey area at the bottom and walk to the center of the waypoint. When they reached the blue area they will decide for the least targeted gate and line up in the subsequent queue.</p>
<p>The last two waiting positions are defined further away from the gates. As agents move to the first available waiting positions in the queue, the congestion (unordered waiting behaviour) forms at the last waiting point in the queue when the gates are full.</p>
</section>
<section id="running-the-simulation">
<h2>Running the Simulation<a class="headerlink" href="#running-the-simulation" title="Link to this heading">#</a></h2>
<p>As a last step we set the missing agent parameters and add the agents to the simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_distribution</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="mf">1.34</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">num_agents</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agent_start_positions</span><span class="p">,</span> <span class="n">v_distribution</span><span class="p">):</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(</span>
            <span class="n">journey_id</span><span class="o">=</span><span class="n">journey_id</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">waypoint_for_distributing</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">desired_speed</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we run the simulation and control the queues. Once an agent has entered one of the four queues, the indivdual waiting time of 10 seconds starts. After the waiting time the agent on the first waiting position in the queue is realeased and the others move up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">queue_started</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">)]</span>
<span class="n">gate_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">)]</span>

<span class="k">while</span> <span class="p">(</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">simulation</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">100</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count_enqueued</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count_enqueued</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">gate_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span> <span class="o">-</span> <span class="n">gate_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">simulation</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization-of-the-results">
<h2>Visualization of the Results<a class="headerlink" href="#visualization-of-the-results" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">trajectory_data</span><span class="p">,</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">)</span>
<span class="n">animate</span><span class="p">(</span><span class="n">trajectory_data</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">,</span> <span class="n">every_nth_frame</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Since the entrance gates are very close to each other it can happen that the agents can get in each other’s way and might be pushed into another gate that is actually not a part of their journey. In this example, the agents are able to solve their conflicts at the beginne. Please note that the position and radius of the distribution waypoint, the speed and starting positions of the agents have a considerable influence on the initial filling of the gates. Agents could be stuck in a queue they didn’t want to go to. To implement the distributing process in a more orderly manner, pre-filtering could be implemented using an additional queue instead of the waypoint for distributing.</p>
</section>
<section id="different-routing-strategy">
<h2>Different Routing Strategy<a class="headerlink" href="#different-routing-strategy" title="Link to this heading">#</a></h2>
<p>In the scenario above it is assumed that the people are evenly distributed among the gates. Therefore, the entrances are evenly occupied. In reality, this is not always the case and often the entrance with the shortest route is chosen. For this reason, we look at another scenario with a different distribution strategy. We can reuse the general settings from above but will change the journey.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_file_uneven</span> <span class="o">=</span> <span class="s2">&quot;queues_waiting_uneven.sqlite&quot;</span>  <span class="c1"># output file</span>
<span class="n">simulation_uneven</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(),</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">geo</span><span class="p">,</span>
    <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file_uneven</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">waypoint_for_distributing</span> <span class="o">=</span> <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">(</span>
    <span class="n">waypoint_coords</span><span class="p">,</span> <span class="n">waypoint_dist</span>
<span class="p">)</span>
<span class="n">exit</span> <span class="o">=</span> <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">waypoints_gates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">add_queue_stage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">waiting_positions_gates</span>
<span class="p">]</span>
<span class="n">queue_gates</span> <span class="o">=</span> <span class="p">[</span><span class="n">simulation_uneven</span><span class="o">.</span><span class="n">get_stage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">waypoints_gates</span><span class="p">]</span>

<span class="n">journey_uneven</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">(</span>
    <span class="p">[</span><span class="n">waypoint_for_distributing</span><span class="p">,</span> <span class="n">exit</span><span class="p">]</span> <span class="o">+</span> <span class="n">waypoints_gates</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are using the <em>round robin</em> approach to distribute the agents on the gates. We define that two people are walking to gate 1 and 2, and the following ones move to gate 3 and 4 (one person each). This means that twice as many agents use gate 1 and 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">journey_uneven</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
    <span class="n">waypoint_for_distributing</span><span class="p">,</span>
    <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_round_robin_transition</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">waypoints_gates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="n">waypoints_gates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="n">waypoints_gates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">waypoints_gates</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="n">waypoints_gates</span><span class="p">:</span>
    <span class="n">journey_uneven</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
        <span class="n">wp</span><span class="p">,</span> <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">exit</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey_uneven</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As a last step we add the agents to the simulation, start the loop and configure the ticket control as in the other scenario. The results show that the entrance on the right side is used more frequently.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agent_start_positions</span><span class="p">,</span> <span class="n">v_distribution</span><span class="p">):</span>
    <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(</span>
            <span class="n">journey_id</span><span class="o">=</span><span class="n">journey_id</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">waypoint_for_distributing</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">desired_speed</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">queue_started</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">)]</span>
<span class="n">gate_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">)]</span>

<span class="k">while</span> <span class="p">(</span>
    <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="ow">and</span> <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">100</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count_enqueued</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count_enqueued</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">gate_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">queue_started</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">simulation_uneven</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">()</span> <span class="o">-</span> <span class="n">gate_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="mi">1000</span>
            <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">queue_gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">simulation_uneven</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
<span class="n">simulation_uneven</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">trajectory_data_uneven</span><span class="p">,</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file_uneven</span><span class="p">)</span>
<span class="n">animate</span><span class="p">(</span><span class="n">trajectory_data_uneven</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">,</span> <span class="n">every_nth_frame</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download">
<h1>Download<a class="headerlink" href="#download" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/12533bdc647753bb29c3fe6cba82185e/queues_waiting.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="motivation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Modelling Motivation</p>
      </div>
    </a>
    <a class="right-next"
       href="routing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How Route Choice can Impact Evacuation Times</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Waiting in Queues</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-the-geometry">Definition of the Geometry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-starting-positions-and-exit">Definition of Starting Positions and Exit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-simulation">Setting up the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-queues">Configure the Queues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-journeys">Configure the Journeys</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-simulation">Running the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-results">Visualization of the Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#different-routing-strategy">Different Routing Strategy</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Forschungszentrum Jülich GmbH, IAS-7.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>