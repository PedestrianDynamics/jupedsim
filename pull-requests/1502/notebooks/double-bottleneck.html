
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/logo.png" sizes="482x536" rel="icon" type="image/png">
    <title>Movement through Bottlenecks &#8212; JuPedSim  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d742c9ce" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/double-bottleneck';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://www.jupedsim.org/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.3.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to work with Journeys" href="journey.html" />
    <link rel="prev" title="Movement around Corners" href="corner.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/jupedsim.svg" class="logo__image only-light" alt="JuPedSim  documentation - Home"/>
    <script>document.write(`<img src="../_static/jupedsim.svg" class="logo__image only-dark" alt="JuPedSim  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PedestrianDynamics/jupedsim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/jupedsim/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/jupedsim" class="icon-link-image" alt="PyPI"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://doi.org/10.5281/zenodo.1293771" title="DOI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.1293771.svg" class="icon-link-image" alt="DOI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/routing.html">Routing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../pedestrian_models/index.html">Pedestrian Models</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Notebooks</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model-comparison.html">Comparative Analysis of Pedestrian Dynamics Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="corner.html">Movement around Corners</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">Movement through Bottlenecks</a></li>

<li class="toctree-l2"><a class="reference internal" href="journey.html">How to work with Journeys</a></li>

<li class="toctree-l2"><a class="reference internal" href="lane-formation.html">Lane formation in bi-directional flow</a></li>

<li class="toctree-l2"><a class="reference internal" href="motivation.html">Modelling Motivation</a></li>

<li class="toctree-l2"><a class="reference internal" href="queues_waiting.html">Waiting in Queues</a></li>

<li class="toctree-l2"><a class="reference internal" href="routing.html">How Route Choice can Impact Evacuation Times</a></li>

<li class="toctree-l2"><a class="reference internal" href="single-file.html">Simulating Single-File Movement</a></li>

</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jupedsim/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation/citation.html">Cite JuPedSim</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="header-article-item"><button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Movement through Bottlenecks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Movement through Bottlenecks</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometry-setup">Geometry Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-start-positions-and-exit">Definition of Start Positions and Exit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-of-parameters-und-running-the-simulation">Specification of Parameters und Running the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-different-bottleneck-widths">Comparison of Different Bottleneck Widths</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-with-a-narrower-bottleneck">Scenario with a Narrower Bottleneck</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-with-a-wider-bottleneck">Scenario with a Wider Bottleneck</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-the-results">Comparison of the Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-further-exploration">References &amp; Further Exploration</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="movement-through-bottlenecks">
<h1>Movement through Bottlenecks<a class="headerlink" href="#movement-through-bottlenecks" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/90746025f1e57ae1c161e204c3d01f34/double-bottleneck.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
<p>In this following, we’ll investigate the movement of a crowd through <strong>two successive bottlenecks</strong> with a simulation. We expect that a jam occurs at the first bottleneck but not at the second one since the flow is considerably reduced by the first bottleneck.</p>
<p>For this purpose, we’ll setup a simulation scenario according to the RiMEA Test 12 [1] and analyse the results with pedpy to inspect the density and flow. After that we’ll vary the width of the bottlenecks and investigate the effects on the movement.</p>
<p>Let’s begin by importing the required packages for our simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jupedsim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pedpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">normal</span>  <span class="c1"># normal distribution of free movement speed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeometryCollection</span><span class="p">,</span> <span class="n">Polygon</span>
</pre></div>
</div>
</div>
</div>
<section id="geometry-setup">
<h2>Geometry Setup<a class="headerlink" href="#geometry-setup" title="Link to this heading">#</a></h2>
<p>Let’s construct the geometry according to RiMEA by defining two rooms and a corridor with a width of 1 meter. To consider the interactions of agents in the second bottleneck (when leaving the second room) the corridor ends 3 meters behind the second room.
By creating the union of all parts we end up with the whole walkable area.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">room1</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
<span class="n">room2</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
<span class="n">corridor</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)])</span>

<span class="n">area</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">(</span><span class="n">corridor</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room2</span><span class="p">)))</span>
<span class="n">walkable_area</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">)</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6b16a959d9bd8da5c60e13f1bc8c2c6e714cd02a57494e4bf18d0b2e14f4438f.png" src="../_images/6b16a959d9bd8da5c60e13f1bc8c2c6e714cd02a57494e4bf18d0b2e14f4438f.png" />
</div>
</div>
</section>
<section id="definition-of-start-positions-and-exit">
<h2>Definition of Start Positions and Exit<a class="headerlink" href="#definition-of-start-positions-and-exit" title="Link to this heading">#</a></h2>
<p>Now we define the spawning area according to RiMEA and calculate 150 positions within that area. The exit area is defined at the end of the corridor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spawning_area</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
<span class="n">num_agents</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">pos_in_spawning_area</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">distribute_by_number</span><span class="p">(</span>
    <span class="n">polygon</span><span class="o">=</span><span class="n">spawning_area</span><span class="p">,</span>
    <span class="n">number_of_agents</span><span class="o">=</span><span class="n">num_agents</span><span class="p">,</span>
    <span class="n">distance_to_agents</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">distance_to_polygon</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">exit_area</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">27</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at our setup:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_simulation_configuration</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span> <span class="n">spawning_area</span><span class="p">,</span> <span class="n">starting_positions</span><span class="p">,</span> <span class="n">exit_area</span>
<span class="p">):</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">*</span><span class="n">spawning_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">*</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;indianred&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">starting_positions</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x/m&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y/m&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_simulation_configuration</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="p">,</span> <span class="n">spawning_area</span><span class="p">,</span> <span class="n">pos_in_spawning_area</span><span class="p">,</span> <span class="n">exit_area</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04dcf8de795d93e463d451060efa6e6d9932a526cfac481f76533d61f44d04c4.png" src="../_images/04dcf8de795d93e463d451060efa6e6d9932a526cfac481f76533d61f44d04c4.png" />
</div>
</div>
</section>
<section id="specification-of-parameters-und-running-the-simulation">
<h2>Specification of Parameters und Running the Simulation<a class="headerlink" href="#specification-of-parameters-und-running-the-simulation" title="Link to this heading">#</a></h2>
<p>Now we just need to define the details of the operational model, routing and the specific agent parameters. In this example, the agents share the same parameters, ecxept for their free movement speed (and starting position).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_file</span> <span class="o">=</span> <span class="s2">&quot;double-botteleneck.sqlite&quot;</span>  <span class="c1"># output file</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(),</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
    <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">exit_id</span><span class="p">])</span>
<span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_distribution</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="mf">1.34</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">num_agents</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_in_spawning_area</span><span class="p">,</span> <span class="n">v_distribution</span><span class="p">):</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(</span>
            <span class="n">journey_id</span><span class="o">=</span><span class="n">journey_id</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">exit_id</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">desired_speed</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="k">while</span> <span class="n">simulation</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">#</a></h2>
<p>Let’s have a look at the visualization of the simulated trajectories:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">trajectory_data</span><span class="p">,</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file</span><span class="p">)</span>
<span class="n">animate</span><span class="p">(</span><span class="n">trajectory_data</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Link to this heading">#</a></h2>
<p>We’ll investigate the <span class="math notranslate nohighlight">\(N-t\)</span> curve and Voronoi density with the help of PedPy.</p>
<p>We evaluate the <span class="math notranslate nohighlight">\(N−t\)</span> curve at the exit for room 1 and room 2. The gradient of this curve provides insights into the flow rate through the bottlenecks. Subsequently, we assess the Voronoi density for the whole geometry. This allows to identify areas in the setup where jamming occurs.</p>
<p>Let’s start with the <span class="math notranslate nohighlight">\(N-t\)</span> curve. We define two measurement lines: between room 1 and the corridor and between room 2 and the corridor. To reuse the measurement lines for the scenario with the wider bottleneck we enlarge it here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">measurement_line1</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">MeasurementLine</span><span class="p">([(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">)])</span>
<span class="n">measurement_line2</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">MeasurementLine</span><span class="p">([(</span><span class="mi">25</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">)])</span>

<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_measurement_setup</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">traj</span><span class="o">=</span><span class="n">trajectory_data</span><span class="p">,</span>
    <span class="n">traj_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">traj_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">measurement_lines</span><span class="o">=</span><span class="p">[</span><span class="n">measurement_line1</span><span class="p">,</span> <span class="n">measurement_line2</span><span class="p">],</span>
    <span class="n">ml_color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="n">ma_line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ma_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c5928dcbca15fd42e7726ecfc39ea33e6abebb094601e72e8a33eef27a68e762.png" src="../_images/c5928dcbca15fd42e7726ecfc39ea33e6abebb094601e72e8a33eef27a68e762.png" />
</div>
</div>
<p>As a next stept we calculate the <span class="math notranslate nohighlight">\(N-t\)</span> data and plot it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nt1</span><span class="p">,</span> <span class="n">crossing_frames1</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_n_t</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data</span><span class="p">,</span>
    <span class="n">measurement_line</span><span class="o">=</span><span class="n">measurement_line1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">nt2</span><span class="p">,</span> <span class="n">crossing_frames2</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_n_t</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data</span><span class="p">,</span>
    <span class="n">measurement_line</span><span class="o">=</span><span class="n">measurement_line2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;N-t&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">nt1</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span>
    <span class="n">nt1</span><span class="p">[</span><span class="s2">&quot;cumulative_pedestrians&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;First Bottleneck&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nt2</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">nt2</span><span class="p">[</span><span class="s2">&quot;cumulative_pedestrians&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Second Bottleneck&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;t / s&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;# Pedestrians&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1720bf0f914fa26d4a574e2fe42481d0d0c24ae0b63649b229730ec6991e137a.png" src="../_images/1720bf0f914fa26d4a574e2fe42481d0d0c24ae0b63649b229730ec6991e137a.png" />
</div>
</div>
<p>The results above show a similar and time-shifted flow for both bottlenecks. Further, to inspect the formation of jamming we analyse the individual speed and density over time. To do so, we use PedPy to calculate the individual speed and Voronoi polygons for each frame calculated by the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">individual_speed</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_individual_speed</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data</span><span class="p">,</span>
    <span class="n">frame_step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">speed_calculation</span><span class="o">=</span><span class="n">pedpy</span><span class="o">.</span><span class="n">SpeedCalculation</span><span class="o">.</span><span class="n">BORDER_SINGLE_SIDED</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">individual_voronoi_cells</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_individual_voronoi_polygons</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data</span><span class="p">,</span>
    <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">cut_off</span><span class="o">=</span><span class="n">pedpy</span><span class="o">.</span><span class="n">Cutoff</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">quad_segments</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we calculate the profiles in a grid of 0.25 x 0.25 meters for the time period in which the agents are entering the first bottleneck. This usually requires a bit of computation time, which is why we only consider 100 frames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_frame_profiles</span> <span class="o">=</span> <span class="mi">1800</span>
<span class="n">max_frame_profiles</span> <span class="o">=</span> <span class="mi">1900</span>

<span class="n">density_profiles</span><span class="p">,</span> <span class="n">speed_profiles</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_profiles</span><span class="p">(</span>
    <span class="n">individual_voronoi_speed_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">individual_voronoi_cells</span><span class="p">[</span>
            <span class="n">individual_voronoi_cells</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
                <span class="n">min_frame_profiles</span><span class="p">,</span> <span class="n">max_frame_profiles</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">individual_speed</span><span class="p">[</span>
            <span class="n">individual_speed</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
                <span class="n">min_frame_profiles</span><span class="p">,</span> <span class="n">max_frame_profiles</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="o">.</span><span class="n">polygon</span><span class="p">,</span>
    <span class="n">grid_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">speed_method</span><span class="o">=</span><span class="n">pedpy</span><span class="o">.</span><span class="n">SpeedMethod</span><span class="o">.</span><span class="n">ARITHMETIC</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_profiles</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">profiles</span><span class="o">=</span><span class="n">density_profiles</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">rho$ / 1/$m^2$&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">plot_profiles</span><span class="p">(</span>
    <span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area</span><span class="p">,</span>
    <span class="n">profiles</span><span class="o">=</span><span class="n">speed_profiles</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;v / m/s&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Speed&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/ec37625b39c6e8ef433bb7a91f38ffd337b0ee4baeee4265405d4cbe60eca454.png" src="../_images/ec37625b39c6e8ef433bb7a91f38ffd337b0ee4baeee4265405d4cbe60eca454.png" />
</div>
</div>
</section>
<section id="comparison-of-different-bottleneck-widths">
<h2>Comparison of Different Bottleneck Widths<a class="headerlink" href="#comparison-of-different-bottleneck-widths" title="Link to this heading">#</a></h2>
<p>As a last step we’ll investigate how the width of the bottleneck influences our results. For this purpose, we’ll configure and run the simulation with the exact same parameters except for the geometry. We will change the width of the corridor to 0.8 and 1.2 meters and compare the results.</p>
<section id="scenario-with-a-narrower-bottleneck">
<h3>Scenario with a Narrower Bottleneck<a class="headerlink" href="#scenario-with-a-narrower-bottleneck" title="Link to this heading">#</a></h3>
<p>Let’s configure the simulation with a corridor width of 0.8 meters. We can reuse most of the parameters from our first simulation.</p>
<p>We define the walkable area:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corridor_narrow</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">)])</span>
<span class="n">area_narrow</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">(</span><span class="n">corridor_narrow</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room2</span><span class="p">)))</span>
<span class="n">walkable_area_narrow</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span><span class="n">area_narrow</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area_narrow</span><span class="p">)</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8f0b4a2975a9f2dd38ab344d694fe3a4f9521d469162598ac215f2b4c83fabcb.png" src="../_images/8f0b4a2975a9f2dd38ab344d694fe3a4f9521d469162598ac215f2b4c83fabcb.png" />
</div>
</div>
<p>The starting positions, exit, operational model parameters and general agent parameter remain the same. So we just need to setup a new simulation object with the journeys:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_file_narrow</span> <span class="o">=</span> <span class="s2">&quot;double-botteleneck_narrow.sqlite&quot;</span>  <span class="c1"># output file</span>
<span class="n">simulation_narrow</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(),</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">area_narrow</span><span class="p">,</span>
    <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file_narrow</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation_narrow</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">exit_id</span><span class="p">])</span>
<span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation_narrow</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And execute the simulation - this may take a bit of computation time since the corridor is quite narrow:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_in_spawning_area</span><span class="p">,</span> <span class="n">v_distribution</span><span class="p">):</span>
    <span class="n">simulation_narrow</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(</span>
            <span class="n">journey_id</span><span class="o">=</span><span class="n">journey_id</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">exit_id</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">desired_speed</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="k">while</span> <span class="n">simulation_narrow</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">simulation_narrow</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">trajectory_data_narrow</span><span class="p">,</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file_narrow</span><span class="p">)</span>
<span class="n">animate</span><span class="p">(</span><span class="n">trajectory_data_narrow</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="scenario-with-a-wider-bottleneck">
<h3>Scenario with a Wider Bottleneck<a class="headerlink" href="#scenario-with-a-wider-bottleneck" title="Link to this heading">#</a></h3>
<p>Next, we configure the simulation with a corridor width of 1.2 meters. The steps are the same as for the narrower botteleck:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corridor_wide</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">)])</span>
<span class="n">area_wide</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">(</span><span class="n">corridor_wide</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">room2</span><span class="p">)))</span>
<span class="n">walkable_area_wide</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">WalkableArea</span><span class="p">(</span><span class="n">area_wide</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pedpy</span><span class="o">.</span><span class="n">plot_walkable_area</span><span class="p">(</span><span class="n">walkable_area</span><span class="o">=</span><span class="n">walkable_area_wide</span><span class="p">)</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c78ce9934894fe662707be4994540543fa6ee20fa7a60feb9d7c2ab944023a87.png" src="../_images/c78ce9934894fe662707be4994540543fa6ee20fa7a60feb9d7c2ab944023a87.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory_file_wide</span> <span class="o">=</span> <span class="s2">&quot;double-botteleneck_wide.sqlite&quot;</span>  <span class="c1"># output file</span>
<span class="n">simulation_wide</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModel</span><span class="p">(),</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">area_wide</span><span class="p">,</span>
    <span class="n">trajectory_writer</span><span class="o">=</span><span class="n">jps</span><span class="o">.</span><span class="n">SqliteTrajectoryWriter</span><span class="p">(</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">trajectory_file_wide</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation_wide</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_area</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">([</span><span class="n">exit_id</span><span class="p">])</span>
<span class="n">journey_id</span> <span class="o">=</span> <span class="n">simulation_wide</span><span class="o">.</span><span class="n">add_journey</span><span class="p">(</span><span class="n">journey</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_in_spawning_area</span><span class="p">,</span> <span class="n">v_distribution</span><span class="p">):</span>
    <span class="n">simulation_wide</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span>
        <span class="n">jps</span><span class="o">.</span><span class="n">CollisionFreeSpeedModelAgentParameters</span><span class="p">(</span>
            <span class="n">journey_id</span><span class="o">=</span><span class="n">journey_id</span><span class="p">,</span>
            <span class="n">stage_id</span><span class="o">=</span><span class="n">exit_id</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
            <span class="n">desired_speed</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="k">while</span> <span class="n">simulation_wide</span><span class="o">.</span><span class="n">agent_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">simulation_wide</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jupedsim.internal.notebook_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate</span><span class="p">,</span> <span class="n">read_sqlite_file</span>

<span class="n">trajectory_data_wide</span><span class="p">,</span> <span class="n">walkable_area</span> <span class="o">=</span> <span class="n">read_sqlite_file</span><span class="p">(</span><span class="n">trajectory_file_wide</span><span class="p">)</span>
<span class="n">animate</span><span class="p">(</span><span class="n">trajectory_data_wide</span><span class="p">,</span> <span class="n">walkable_area</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="comparison-of-the-results">
<h3>Comparison of the Results<a class="headerlink" href="#comparison-of-the-results" title="Link to this heading">#</a></h3>
<p>Now we can compare the <span class="math notranslate nohighlight">\(N-t\)</span> curves for the three scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nt1_narrow</span><span class="p">,</span> <span class="n">crossing_frames1_narrow</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_n_t</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data_narrow</span><span class="p">,</span>
    <span class="n">measurement_line</span><span class="o">=</span><span class="n">measurement_line1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">nt1_wide</span><span class="p">,</span> <span class="n">crossing_frames1_wide</span> <span class="o">=</span> <span class="n">pedpy</span><span class="o">.</span><span class="n">compute_n_t</span><span class="p">(</span>
    <span class="n">traj_data</span><span class="o">=</span><span class="n">trajectory_data_wide</span><span class="p">,</span>
    <span class="n">measurement_line</span><span class="o">=</span><span class="n">measurement_line1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;N-t for Different Bottleneck Widths&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">nt1_narrow</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span>
    <span class="n">nt1_narrow</span><span class="p">[</span><span class="s2">&quot;cumulative_pedestrians&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;0.8 m First Bottleneck&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">nt1</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">nt1</span><span class="p">[</span><span class="s2">&quot;cumulative_pedestrians&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1.0 m First Bottleneck&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">nt1_wide</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span>
    <span class="n">nt1_wide</span><span class="p">[</span><span class="s2">&quot;cumulative_pedestrians&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1.2 m First Bottleneck&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;t / s&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;# Pedestrians&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/121a9de47402ea0c5261fbaf2179ef6cf5833686a19052ca7d22921830bdc7a6.png" src="../_images/121a9de47402ea0c5261fbaf2179ef6cf5833686a19052ca7d22921830bdc7a6.png" />
</div>
</div>
<p>The results show: the smaller the width of the bottleneck, the smaller the flow as it takes longer for all 150 agents to enter the first bottleneck.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download">
<h1>Download<a class="headerlink" href="#download" title="Link to this heading">#</a></h1>
<p>This notebook can be directly downloaded <a class="reference download internal" download="" href="../_downloads/90746025f1e57ae1c161e204c3d01f34/double-bottleneck.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> to run it locally.</p>
<section id="references-further-exploration">
<h2>References &amp; Further Exploration<a class="headerlink" href="#references-further-exploration" title="Link to this heading">#</a></h2>
<p>[1] RiMEA, ‘Guideline for Microscopic Evacuation Analysis’(2016), URL: https://rimea.de/</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="corner.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Movement around Corners</p>
      </div>
    </a>
    <a class="right-next"
       href="journey.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How to work with Journeys</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Movement through Bottlenecks</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometry-setup">Geometry Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-start-positions-and-exit">Definition of Start Positions and Exit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-of-parameters-und-running-the-simulation">Specification of Parameters und Running the Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-different-bottleneck-widths">Comparison of Different Bottleneck Widths</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-with-a-narrower-bottleneck">Scenario with a Narrower Bottleneck</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-with-a-wider-bottleneck">Scenario with a Wider Bottleneck</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-the-results">Comparison of the Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download">Download</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-further-exploration">References &amp; Further Exploration</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Forschungszentrum Jülich GmbH, IAS-7.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>