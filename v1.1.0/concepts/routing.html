

<!DOCTYPE html>


<html lang="en" data-content_root="" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
    <link href="../_static/logo.png" sizes="482x536" rel="icon" type="image/png">
    <title>Routing &#8212; JuPedSim  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'concepts/routing';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://www.jupedsim.org/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.1.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Notebooks" href="../notebooks/index.html" />
    <link rel="prev" title="Geometry" href="geometry.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/jupedsim.svg" class="logo__image only-light" alt="JuPedSim  documentation - Home"/>
    <script>document.write(`<img src="../_static/jupedsim.svg" class="logo__image only-dark" alt="JuPedSim  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PedestrianDynamics/jupedsim" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/jupedsim/" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/jupedsim" class="icon-link-image" alt="PyPI"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://doi.org/10.5281/zenodo.1293771" title="DOI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.1293771.svg" class="icon-link-image" alt="DOI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../notebooks/getting_started.html">Getting started</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Concepts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="geometry.html">Geometry</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Routing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notebooks/index.html">Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/corner.html">Movement around Corners</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/double-bottleneck.html">Movement through Bottlenecks</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/journey.html">How to work with Journeys</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/lane-formation.html">Lane formation in bi-directional flow</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/motivation.html">Modelling Motivation</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/queues_waiting.html">Waiting in Queues</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/routing.html">How Route Choice can Impact Evacuation Times</a></li>

<li class="toctree-l2"><a class="reference internal" href="../notebooks/single-file.html">Simulating Single-File Movement</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jupedsim/index.html">API reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="header-article-item"><label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Routing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#route-planning">Route planning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stages">Stages</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waypoint">Waypoint</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exit">Exit</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-queue">Waiting Queue</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-set">Waiting Set</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#journeys">Journeys</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transitions">Transitions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fixed-transition">Fixed transition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#round-robin-transition">Round-robin transition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#least-targeted-transition">Least-targeted transition</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#way-finding">Way finding</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="routing">
<h1>Routing<a class="headerlink" href="#routing" title="Permalink to this heading">#</a></h1>
<p>Routing in pedestrian dynamics simulations refers to the process of determining how individuals navigate through a physical environment, such as a street, building, or public space.
In <em>JuPedSim</em> this consists of two fundamental parts:</p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="#route-planning"><span class="std std-ref">Route planning</span></a>:</dt><dd><p>Route planning models the decision-making process of the agents on their route through the simulation.
On base of the underlying route, the target of the agents is distinguished.
These may include condition-based decisions, where the way of different agents on the same route may differ.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#way-finding"><span class="std std-ref">Way finding</span></a>:</dt><dd><p>Wayfinding is the process by which agents decide on a route to reach their target.
This process typically considers factors like the agent’s goal (target), the layout of the environment, available pathways, and the agent’s knowledge of the surroundings.</p>
</dd>
</dl>
</li>
</ul>
<p>For more information how this can be included in a <em>JuPedSim</em> simulation, and what the underlying principles are, see the following sections.</p>
<section id="route-planning">
<h2>Route planning<a class="headerlink" href="#route-planning" title="Permalink to this heading">#</a></h2>
<p>For modeling complex scenarios in which the agents will move through different specific targets on their way, it is possible to define routes.
These routes are modeled as a network, where each target is a node, and the nodes can be connected, indicating how the agent might continue their route.
The illustration of such a network can be seen below:</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/route-planning.svg"><img alt="A graphical representation of a directed graph." src="../_images/route-planning.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-text">Graphical representation of the underlying routing network of a more complex simulation.
Each circle represents an intermediate stage, while the arrows the corresponding connections.</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In the following sections, we will explain how to set-up such routing networks in <em>JuPedSim</em>.</p>
<section id="stages">
<h3>Stages<a class="headerlink" href="#stages" title="Permalink to this heading">#</a></h3>
<p>In <em>JuPedSim</em>, a stage refers to an interim target that the agent aims to reach.
When a stage is reached, the agent will wait for its completion and then continue to the next stage.
A stage may already count as completed when the stage is reached or when some condition is fulfilled.
The various types of stages will be explained below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All stages added to the simulation need to be inside the walkable area.
This needs to be uphold when the geometry is changed.</p>
</div>
<section id="waypoint">
<h4>Waypoint<a class="headerlink" href="#waypoint" title="Permalink to this heading">#</a></h4>
<p>The most fundamental kind of stage is a <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.WaypointStage" title="jupedsim.stages.WaypointStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code></a>. It represents a target the agent needs to reach.
For the way finding, the agent always targets the Waypoint directly.
A Waypoint is considered completed once agents arrive within a designated distance from the defined Waypoint.
The figure below shows how a Waypoint is used in the simulation. Here the center (colored orange) represents the Waypoint, and the surrounding blue area indicates the zone an agent must enter to complete the stage.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/waypoint.svg"><img alt="A dot representing the Waypoint, with an circle around it, depicting the area an agent needs to enter to complete the stage." src="../_images/waypoint.svg" width="20%" /></a>
<figcaption>
<p><span class="caption-text">Representation of a <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.WaypointStage" title="jupedsim.stages.WaypointStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code></a> (colored orange) with the given distance (orange line).</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A Waypoint at <span class="math notranslate nohighlight">\((0.6, -1.4)\)</span> with an accepted distance of 2m can be added to the simulation via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">waypoint_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_waypoint_stage</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exit">
<h4>Exit<a class="headerlink" href="#exit" title="Permalink to this heading">#</a></h4>
<p>An other stage type is the <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.ExitStage" title="jupedsim.stages.ExitStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exit</span></code></a>. As the name suggests, this stage models the exits within the simulation.
The <cite>ExitStage</cite> designates an area where agents are marked for removal from the simulation upon their arrival.
The removal itself is done at the beginning of the next iteration step.
As a target the agents will aim for the center of the exit polygon.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents will be removed from the simulation when they reach the designated exit area.</p>
</div>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/exit.svg"><img alt="A polygon representing the exit area is shown in blue, with the center highlighted in orange." src="../_images/exit.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-text">Representation of an <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.ExitStage" title="jupedsim.stages.ExitStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exit</span></code></a> (colored blue). The agents will aim for the center (colored orange).</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>An exit located in the polygon <span class="math notranslate nohighlight">\((-0.2, -1.9), (0.2, -1.9), (0.2, -1.7), (-0.2, -1.7)\)</span> can be added to the simulation via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create exit from coordinates</span>
<span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">([(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">)])</span>

<span class="c1"># create exit from shapely.Polygon</span>
<span class="n">exit_polygon</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">)])</span>
<span class="n">exit_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_exit_stage</span><span class="p">(</span><span class="n">exit_polygon</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, pedestrians in the simulation are programmed to target the center of the exit area.
Therefore, creating wide exits could potentially lead to unpredictable behavior.
In certain situations, it may be more appropriate to establish multiple exits rather than a single wide one.</p>
</div>
</section>
<section id="waiting-queue">
<h4>Waiting Queue<a class="headerlink" href="#waiting-queue" title="Permalink to this heading">#</a></h4>
<p>It is not only possible to steer agents with waypoints, it is also possible to let them wait in queues.
<em>JuPedSim</em> offers <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.NotifiableQueueStage" title="jupedsim.stages.NotifiableQueueStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Queues</span></code></a> where the agents will wait at predefined positions.
The positions given are arranged according to the sequence in which they are defined, and agents will wait at the first available spot.
When agents leave the queue, the other agents will move up in their waiting positions until they reach the front.
In order to allow agents to leave the queue, a signal must be sent to it, indicating that the first <cite>n</cite> agents in the queue are permitted to exit.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the number of agents arriving at the queue exceeds the available waiting positions, all additional agents beyond capacity will wait at the last designated waiting position.</p>
</div>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/queue.svg"><img alt="A series of dots represent the different waiting positions, connected with arrows which show in which direction the agents will move up." src="../_images/queue.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-text">Representation of the <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.NotifiableQueueStage" title="jupedsim.stages.NotifiableQueueStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Queue</span></code></a> (dots).
The first position is marked orange and the last position light-blue.
The movement of the agents to move up the queue is indicated by the red arrows.</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The following code snippet creates a Queue with five waiting spots at (0, 0), (0, 5), (0, 10), (0, 15), and (0, 20) and adds it to the simulation.
Afterwards, it retrieves the Queue object from the simulation and then releases the first two and then the first agent from the simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add the queue to the simulation</span>
<span class="n">queue_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_queue_stage</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># retrieve queue from the simulation</span>
<span class="n">queue</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_stage</span><span class="p">(</span><span class="n">queue_id</span><span class="p">)</span>

<span class="o">...</span>

<span class="c1"># notify that the first 2 agents can move to the next stage</span>
<span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># notify that the first agent can move to the next stage</span>
<span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="waiting-set">
<h4>Waiting Set<a class="headerlink" href="#waiting-set" title="Permalink to this heading">#</a></h4>
<p>A second option to introduce a waiting stage to the simulation are <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.WaitingSetStage" title="jupedsim.stages.WaitingSetStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaitingSets</span></code></a>.
They consists of multiple waiting positions which will be filled in the order of their definition, when creating the waiting set.
A waiting set can either be active, which means the agents will wait there, or inactive, which will release all waiting agents.
If a waiting set is inactive when an agents targets it, the first defined waiting position will be used as a waypoint.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the number of agents targeting the waiting set exceeds the available waiting spots, the agents in excess will wait at the position where the last agent entered the waiting area.</p>
</div>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/waiting_set.svg"><img alt="A waiting set is represented by a number of unevenly distributed circles. Two circles are highlighted." src="../_images/waiting_set.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-text">Representation of the <a class="reference internal" href="../api/jupedsim/stages/index.html#jupedsim.stages.WaitingSetStage" title="jupedsim.stages.WaitingSetStage"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaitingSet</span></code></a>.
The first (colored orange) and last defined position (colored blue) are highlighted.</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In the following, you can see how to add a waiting set to a simulation and how to activate and deactivate it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add the waiting set to the simulation</span>
<span class="n">waiting_set_id</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_waiting_set_stage</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="c1"># retrieve waiting set from the simulation</span>
<span class="n">waiting_set</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_stage</span><span class="p">(</span><span class="n">waiting_set_id</span><span class="p">)</span>

<span class="o">...</span>

<span class="c1"># deactivate the waiting</span>
<span class="n">waiting_set</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">jupedsim</span><span class="o">.</span><span class="n">WaitingSetState</span><span class="o">.</span><span class="n">INACTIVE</span>

<span class="o">...</span>

<span class="c1"># activate the waiting again</span>
<span class="n">waiting_set</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">jupedsim</span><span class="o">.</span><span class="n">WaitingSetState</span><span class="o">.</span><span class="n">ACTIVE</span>
</pre></div>
</div>
</section>
</section>
<section id="journeys">
<h3>Journeys<a class="headerlink" href="#journeys" title="Permalink to this heading">#</a></h3>
<p>For creating more complex routes in <em>JuPedSim</em> multiple stages can be combined to a so called Journey.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create stages</span>
<span class="o">...</span>

<span class="c1"># define a journey</span>
<span class="n">journey</span> <span class="o">=</span> <span class="n">jps</span><span class="o">.</span><span class="n">JourneyDescription</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">waypoint_id</span><span class="p">,</span>
        <span class="n">queue_id</span><span class="p">,</span>
        <span class="n">waiting_set_id</span><span class="p">,</span>
        <span class="n">exit_id</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="transitions">
<h3>Transitions<a class="headerlink" href="#transitions" title="Permalink to this heading">#</a></h3>
<p>We currently have a Journey composed of various stages that are not interconnected.
To establish a comprehensive routing setup, we need to define the connections between these stages, known as Transitions.</p>
<p>Transitions specify which stage an agent will target next after completing its current stage.
<em>JuPedSim</em> offers different types of connections to directly model certain decision making processes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When adding the transitions to your journeys make sure, that <a class="reference internal" href="#exit"><span class="std std-ref">Exits</span></a> are only added at the end of a trip.
Otherwise the agents will be removed from the simulation when they reach the exit and will not advance to the next stage.</p>
</div>
<section id="fixed-transition">
<h4>Fixed transition<a class="headerlink" href="#fixed-transition" title="Permalink to this heading">#</a></h4>
<p>The most basic form of transition is to define that the agent will proceed on its journey with one specific subsequent stage.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/fixed.svg"><img alt="../_images/fixed.svg" src="../_images/fixed.svg" width="40%" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
    <span class="n">start_stage_id</span><span class="p">,</span>
    <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_fixed_transition</span><span class="p">(</span><span class="n">next_stage_id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="round-robin-transition">
<h4>Round-robin transition<a class="headerlink" href="#round-robin-transition" title="Permalink to this heading">#</a></h4>
<p>It is also possible to model a decision making process and split the agents at a stage, with a round-robin transition.
Here, the agents will proceed in a weighted round-robin manner.
E.g., when defining a round-robin transition with three outgoing stages and the corresponding weights 10, 5, 1, the first 10 agents to make a choice will continue with the first given stage.
The next 4 with the second one, and the next agent will continue with the third stage.</p>
<p>After this, the cycle restarts with the first stage.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/round_robin.svg"><img alt="../_images/round_robin.svg" src="../_images/round_robin.svg" width="40%" /></a>
</figure>
<p>To create a round-robin transition as described above, you can follow these steps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
    <span class="n">start_stage_id</span><span class="p">,</span>
    <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_round_robin_transition</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">first_candidate_stage_id</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="p">(</span><span class="n">second_candidate_stage_id</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="n">third_candidate_stage_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="least-targeted-transition">
<h4>Least-targeted transition<a class="headerlink" href="#least-targeted-transition" title="Permalink to this heading">#</a></h4>
<p>An other option to model decision making processes, is the least-targeted transition.
The next stage is determined from a list of candidates by checking which of the candidates has the least number of agents targeting it already.
When multiple stages have the same number of agent targeting the first defined will be chosen.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/least_targeted.svg"><img alt="../_images/least_targeted.svg" src="../_images/least_targeted.svg" width="40%" /></a>
</figure>
<p>A least-targeted transition can be added to a journey with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">journey</span><span class="o">.</span><span class="n">set_transition_for_stage</span><span class="p">(</span>
    <span class="n">start_stage_id</span><span class="p">,</span>
    <span class="n">jps</span><span class="o">.</span><span class="n">Transition</span><span class="o">.</span><span class="n">create_least_targeted_transition</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">first_candidate_stage_id</span><span class="p">,</span>
            <span class="n">second_candidate_stage_id</span><span class="p">,</span>
            <span class="n">third_candidate_stage_id</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="way-finding">
<h2>Way finding<a class="headerlink" href="#way-finding" title="Permalink to this heading">#</a></h2>
<p>Each agent in the simulation is assigned a specific target destination towards which they will head.
The next crucial step is to determine the route that these agents will take to reach their assigned goals.
This involves calculating the most efficient or desired paths from their current locations to their targets within the simulation environment.</p>
<p>To determine the route, <em>JuPedSim</em> triangulates the geometry and computes the distance between two points through the triangulation.
Here, it will compute the distance between the centers of two neighboring triangles.
When multiple paths lead to the target, the shortest one will be preferred.</p>
<p>How the path is distinguished for different target points, you can see in the animation below:</p>
<a class="reference internal image-reference" href="../_images/shortest_path.gif"><img alt="../_images/shortest_path.gif" class="align-center" src="../_images/shortest_path.gif" style="width: 60%;" /></a>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As the distance is computed along the centers of the triangles, it may happen, that not the shortest-path on the ground is taken.
This is a known issue of the <em>JuPedSim</em>’s routing, that will be fixed in the near future.
To avoid this behaviour intermediate waypoints can be added to the simulation.</p>
<a class="reference internal image-reference" href="../_images/expected_routing.png"><img alt="../_images/expected_routing.png" src="../_images/expected_routing.png" style="width: 40%;" /></a>
<a class="reference internal image-reference" href="../_images/unexpected_routing.png"><img alt="../_images/unexpected_routing.png" src="../_images/unexpected_routing.png" style="width: 40%;" /></a>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="geometry.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Geometry</p>
      </div>
    </a>
    <a class="right-next"
       href="../notebooks/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#route-planning">Route planning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stages">Stages</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waypoint">Waypoint</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exit">Exit</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-queue">Waiting Queue</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-set">Waiting Set</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#journeys">Journeys</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transitions">Transitions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fixed-transition">Fixed transition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#round-robin-transition">Round-robin transition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#least-targeted-transition">Least-targeted transition</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#way-finding">Way finding</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Forschungszentrum Jülich GmbH, IAS-7.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>